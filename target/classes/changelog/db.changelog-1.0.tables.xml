<?xml version="1.1" encoding="UTF-8" standalone="no"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">

  <preConditions>
    <dbms type="postgresql"/>
  </preConditions>

  <changeSet author="antelif" id="book-table-creation" failOnError="true">
    <preConditions>
      <not>
        <tableExists tableName="book"/>
      </not>
    </preConditions>
    <createTable tableName="book">
      <column name="id" type="SERIAL">
        <constraints nullable="false" primaryKey="true" primaryKeyName="book_pkey"/>
      </column>
      <column name="isbn" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="title" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="author" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="publisher" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet author="antelif" id="book_copy-table-creation" failOnError="true">
    <preConditions>
      <not>
        <tableExists tableName="book_copy"/>
      </not>

    </preConditions>
    <createTable tableName="book_copy">
      <column name="id" type="SERIAL">
        <constraints nullable="false" primaryKey="true" primaryKeyName="commission_pkey"/>
      </column>
      <column name="book_id" type="INTEGER">
        <constraints nullable="false"/>
      </column>
      <column name="state" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="status" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet author="antelif" id="customer-table-creation" failOnError="true">
    <preConditions>
      <not>
        <tableExists tableName="customer"/>
      </not>
    </preConditions>
    <createTable tableName="customer">
      <column name="id" type="SERIAL">
        <constraints nullable="false" primaryKey="true" primaryKeyName="competition_pkey"/>
      </column>
      <column name="name" type="VARCHAR(255)"/>
      <column name="surname" type="VARCHAR(255)"/>
      <column name="phone" type="INTEGER"/>
      <column name="email" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name ="fee" type="FLOAT8"/>
    </createTable>
  </changeSet>

  <changeSet author="antelif" id="personnel-table-creation" failOnError="true">
    <preConditions>
      <not>
        <tableExists tableName="personnel"/>
      </not>
    </preConditions>
    <createTable tableName="personnel">
      <column name="id" type="SERIAL">
        <constraints nullable="false" primaryKey="true" primaryKeyName="currency_pkey"/>
      </column>
      <column name="USERNAME" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
      <column name="password" type="VARCHAR(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet author="antelif" id="transaction-table-creation" failOnError="true">
    <preConditions>
      <not>
        <tableExists tableName="transaction"/>
      </not>
    </preConditions>
    <createTable tableName="transaction">
      <column name="id" type="SERIAL">
        <constraints nullable="false" primaryKey="true" primaryKeyName="operator_pkey"/>
      </column>
      <column name="book_id" type="INTEGER">
        <constraints nullable="false"/>
      </column>
      <column name="customer_id" type="INTEGER">
        <constraints nullable="false"/>
      </column>
      <column name="personnel_id" type="INTEGER">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet author="antelif" id="book_copy-to-book-fk">
    <addForeignKeyConstraint baseColumnNames="book_id" baseTableName="book_copy"
      constraintName="book_copy_fk1" deferrable="false" initiallyDeferred="false"
      onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
      referencedTableName="book" validate="true"/>
  </changeSet>
  <changeSet author="antelif" id="transaction-to-book_copy">
    <addForeignKeyConstraint baseColumnNames="book" baseTableName="transaction"
      constraintName="transaction_fk1" deferrable="false" initiallyDeferred="false"
      onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
      referencedTableName="book_copy" validate="true"/>
  </changeSet>
  <changeSet author="antelif" id="transaction-to-customer-fk">
    <addForeignKeyConstraint baseColumnNames="customer" baseTableName="transaction"
      constraintName="transaction_fk2" deferrable="false" initiallyDeferred="false"
      onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
      referencedTableName="customer" validate="true"/>
  </changeSet>
  <changeSet author="antelif" id="transaction-to-personnel">
    <addForeignKeyConstraint baseColumnNames="personnel" baseTableName="transaction"
      constraintName="transaction_fk3" deferrable="false" initiallyDeferred="false"
      onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
      referencedTableName="personnel" validate="true"/>
  </changeSet>

</databaseChangeLog>
